#[test_only]
module halo2_verifier::verifier_test {
    use halo2_verifier::params;
    use halo2_verifier::protocol;
    use std::vector;
    use aptos_std::crypto_algebra;
    use halo2_verifier::halo2_verifier;
    use aptos_std::crypto_algebra::Element;
    use std::bn254_algebra::Fr;
    use halo2_verifier::bn254_utils;
    use std::option;

    // the following param data is generated from `crates/vk-gen-examples/params/challenge_0078-kzg_bn254_16.srs`

    #[test_only]
    const G1: vector<u8> = x"0100000000000000000000000000000000000000000000000000000000000000";
    #[test_only]
    const G2: vector<u8> = x"edf692d95cbdde46ddda5ef7d422436779445c5e66006a42761e1f12efde0018c212f3aeb785e49712e7a9353349aaf1255dfb31b7bf60723a480d9293938e19";
    #[test_only]
    const S_G2: vector<u8> = x"e4115200acc86e7670c83ded726335def098657fe8668323e9e41e6781b83b0a9d83b54bbb00215323ce6d7f9d7f331a286d7707d03f7dbdd3125c6163588d53";

    #[test(s = @aptos_std)]
    public fun check_verify_ok(s: &signer) {
        crypto_algebra::enable_cryptography_algebra_natives(s);
        let params = params::new_for_test(&G1, &G2, &S_G2);
        let protocol = protocol::from_bytes(vector[
            x"4c8aec124671615151f42649e5d8c1541856c5d625556afbc1662fe0e7dc081d",
            x"86bfd56e62113cf6ba7ec4b34c39c82484e68e6df63656870ba7d83d5673dc2a",
            x"906051b4ffd4a6f7ae18d4dd15d08f70de09c2b6b027c1af2315aa2e2d8d30555a720ae55cae6f47a56b726aa34908878c47bb62da660f0b73559012af4f3b1c6e06c9cf7175ec851a6f52b92f27f70f2ee2f42f582dd58e18f68eaa09a185610e8d704d308e0425cf8e4c1da6b23a4402cad36d0a30b9429d4c999d09d03157",
            x"00",
            x"10",
            x"01000000",
            x"03000000",
            x"0100000000000000",
            x"0100000000000000",
            x"000000",
            x""
            ],
            vector[
            x"00000000000100000000",
            x"00010000000100000000",
            x"00020000000100000000"
            ],
            vector[
            x"f4000000000100000000"
            ],
            vector[x"ff000000000100000000"],
            vector[
            x"f400000000",
            x"0000000000",
            x"0001000000",
            x"0002000000"
            ],
            vector[
            x"02000000000000f093f5e1439170b97948e833285d588181b64550b829a031e1724e64300200000002000000010000000300000001000000010000000000000000000000000000000000000000000000000000000000000003000000000000000100000001000000010000000300000001000000"
            ],
            vector[],
            vector[]
        );
        let proof = x"d88965f5f7063fcc261cc54fdab987086283c08dfb9b1660831630fdb3ecfe116cc050fc600747c895af81bea0c8ab85f406f14398ead3bb4c2f9814e0c9411bbf3d871f60c8cb31a774265b0fadd8b9b43268bede7c5843447c09026875a226f165a578dd2084eb3c6679546fcb721fd44a2545ee7b12b7a334e996d009fa62fdfad3e5fbd422da30255290ebe64ffdfc1cdce0d0420f90f56018c9c032072a70d7e3df51db1626c50eb9196f8aa758ce99065982ae44bdd32d4f4b1805a812adaf8a39705fde491cccce6c489bb702475ba6e8f52b2eed03325f717ff6766ec3a7f0c24a01bb8ba34a7ab619de6c0eff1517ed21baddd8eaaead962aa02d4f72f3c4beb975434cab2066bfec2155f4538fe5ffc414e43192079e72cbfca963e2662ed1ede433f7b95cd3045bd20b9b2b11206e299a1c4df5a54ebb1a94bd0adfd139bccb1fa0fe249dcb16e49aa28a6682ac0615b647055095d5e25059a4219c9c6c1ca66a879c3a1f1bf26e1ac46a066f391282cacda63ad870e69bb50a0afc2089de50f5cd77ebaa42997411c9129eb795ee43d3e797b31b02e9efc0910679a414c438b29a7799535ba4d86c1b1f3b708f622047af144299b18dc9112c16aa6358390e01791bc3e1847ca0a21d9bffbe5fcc0cc89643628cd438eb354c1c643c96eb02cbebabd11964e6547db17a99cd7c1cf78d9801437c2cf5d4f3de293c24b1ca56ba2efe8acf9ff61c80d1bed1cb5fd2e1ec5d60a93d8da12d6dbc294cba546f226f3826cf57790eb27770fa80109e7b900f9c3cf80db6b0e19fbe224e831721203798ee99b775992a5402e622e6cf42214963bc26f0f580440bd5177770bf6c73a14b2ca1456a1ac4574c913c854643d01891b6ca21cc0cd7cf89065084b655bb5241e298fd79172695a5846fa2d72ed13de1d4def774d777853e00f236bcf20e192389984f8d7ca7f792d2a19095fdab507a4bb550e409bb7839309d00caa66bf09e39b220feda32dc87ff932b6ba0cee952cc568201a324119800ec16be577d002821c19942bbffdba6fe2c3064e9a1ae513ebc5daf31f7b97d16b6bb7a298bd655319f135fc24157fb28bc66f4742863b68c2cbbe4c7e6d7f419c7ce209925f79129e50b908fa2255e565c6bcbf10d18b569c48a79a1992e8126e150b683d723ebfd1d96a08c1722bd786ef66df6d80e3fc5501b0b14a7c1670b6c3109a5afe04f164a64f1d04dc207de7ba5934b39e857717064a9c48853882747a9bfdd294c1a2641f830221cdb91cb6f874c461fa888b5d845c52f6169cd145b8751436f92d8d87f515ebd58e369240284bac685569fd065229d0467734a0c1df98dd2acfcc27c5b0947d0a80cc0caba22b0ce72ec5ac34039649d53176c5b921188c9bffab720758be2fa9eea73b27155570e64beb1a6f5ea16336ef42108d13f7d8d0f460d2639528224660337561083ec01f35c510feb3c570ecda7da08";
        let instances = vector[
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000",
        x"0600000000000000000000000000000000000000000000000000000000000000"            
        ];
        let instances = vector::map_ref<vector<u8>, Element<Fr>>(&instances, |instance| {
            option::destroy_some( bn254_utils::deserialize_fr(instance))
        });
        let result = halo2_verifier::verify(&params, &protocol, vector::singleton(vector::singleton(instances)), proof);
        assert!(result, 100);
    }
}
